require 'rho/rhoapplication'

class AppApplication < Rho::RhoApplication
  def initialize
    if Category.find(:all).size == 0 || Map.find(:all).size == 0
      Rhom::Rhom.database_full_reset(false, true)
      # PLACEHOLDER: categories & maps, i.e. categories.each{|category| Category.create(category) }
      [{'sign'=>"position",'name_ua'=>"Географічне положення",'name_ru'=>"Географическое положение"},{'sign'=>"weather",'name_ua'=>"Поверхня Києва. Погода",'name_ru'=>"Поверхность Киева. Погода"},{'sign'=>"florafauna",'name_ua'=>"Рослинність і тваринний світ",'name_ru'=>"Растительность и животный мир"},{'sign'=>"population",'name_ua'=>"Населення. Історія та сучасність",'name_ru'=>"Население. История и современность"},{'sign'=>"economics",'name_ua'=>"Господарська діяльність",'name_ru'=>"Хозяйственная деятельность"},{'sign'=>"past",'name_ua'=>"Київ у минулому",'name_ru'=>"Киев в прошлом"}].each{|category| Category.create(category) }
      [{'category_sign'=>"position",'name_ua'=>"Світ",'name_ru'=>"Мир",'file'=>"GPWorld",'summary'=>"GPWorld",'pictures_list'=>"GP",'questionnaire'=>"GP"},{'category_sign'=>"position",'name_ua'=>"Європа. Україна. Околиці Києва",'name_ru'=>"Европа. Украина. Окраины Киева",'file'=>"GPEurUA",'summary'=>"GPEurUA",'pictures_list'=>"GP",'questionnaire'=>"GP"},{'category_sign'=>"position",'name_ua'=>"Відстані від Києва до інших міст",'name_ru'=>"Расстояния от Киева в другие города",'file'=>"Europe",'pictures_list'=>"GP",'questionnaire'=>"GP"},{'category_sign'=>"weather",'name_ua'=>"Рельєф. Річки та озера",'name_ru'=>"Рельеф. Реки и озера",'file'=>"Rel0",'summary'=>"Rel",'pictures_list'=>"RelWeather",'questionnaire'=>"RelWeather"},{'category_sign'=>"weather",'name_ua'=>"Рельєф центру міста",'name_ru'=>"Рельеф центра города",'file'=>"Rel1",'summary'=>"Rel",'pictures_list'=>"RelWeather",'questionnaire'=>"RelWeather"},{'category_sign'=>"weather",'name_ua'=>"Водопостачання",'name_ru'=>"Водоснабжение",'file'=>"WaterSupply",'summary'=>"WaterSupply",'pictures_list'=>"RelWeather",'questionnaire'=>"RelWeather"},{'category_sign'=>"weather",'name_ua'=>"Ґрунти",'name_ru'=>"Почвы",'file'=>"Soils",'summary'=>"Soils",'pictures_list'=>"RelWeather",'questionnaire'=>"RelWeather"},{'category_sign'=>"weather",'name_ua'=>"Пори року. Пункти спостереження за природою",'name_ru'=>"Времена года. Пункты наблюдения за природой",'file'=>"Weather",'summary'=>"Weather",'pictures_list'=>"RelWeather",'questionnaire'=>"RelWeather"},{'category_sign'=>"florafauna",'name_ua'=>"Рослинність і тваринний світ",'name_ru'=>"Растительность и животный мир",'file'=>"PlantsAnimals",'summary'=>"PlantsAnimals",'pictures_list'=>"PlantsAnimals",'questionnaire'=>"PlantsAnimals"},{'category_sign'=>"florafauna",'name_ua'=>"Центральний ботанічний сад ім. М. Гришка",'name_ru'=>"Центральный ботанический сад им. Н. Гришко",'file'=>"BotHrishka",'summary'=>"BotHrishka",'pictures_list'=>"PlantsAnimals",'questionnaire'=>"PlantsAnimals"},{'category_sign'=>"florafauna",'name_ua'=>"Ботанічний сад ім. О. Фоміна",'name_ru'=>"Ботанический сад им. А. Фомина",'file'=>"BotFomina",'summary'=>"BotFomina",'pictures_list'=>"PlantsAnimals",'questionnaire'=>"PlantsAnimals"},{'category_sign'=>"florafauna",'name_ua'=>"Зоопарк",'name_ru'=>"Зоопарк",'file'=>"Zoo",'summary'=>"Zoo",'pictures_list'=>"PlantsAnimals",'questionnaire'=>"PlantsAnimals"},{'category_sign'=>"florafauna",'name_ua'=>"Центральний парк культури та відпочинку",'name_ru'=>"Центральный парк культуры и отдыха",'file'=>"CultRest",'summary'=>"CultRest",'pictures_list'=>"PlantsAnimals",'questionnaire'=>"PlantsAnimals"},{'category_sign'=>"population",'name_ua'=>"Адміністративні райони",'name_ru'=>"Административные районы",'file'=>"Admin",'summary'=>"Admin",'pictures_list'=>"Admin",'questionnaire'=>"Population"},{'category_sign'=>"population",'name_ua'=>"Історичні місцевості та зміни території",'name_ru'=>"Исторические места и изменения территории",'file'=>"HistPlaces",'summary'=>"Population",'pictures_list'=>"Admin",'questionnaire'=>"Population"},{'category_sign'=>"population",'name_ua'=>"Зміни чисельності населення",'name_ru'=>"Изменения численности населения",'file'=>"Population",'summary'=>"Population",'questionnaire'=>"Population"},{'category_sign'=>"population",'name_ua'=>"Центр Києва",'name_ru'=>"Центр Киева",'file'=>"KievCenter",'summary'=>"KievCenter",'pictures_list'=>"KievCenter",'questionnaire'=>"Population"},{'category_sign'=>"population",'name_ua'=>"Заповідник «Софія Київська»",'name_ru'=>"Заповедник «София Киевская»",'file'=>"Sofia",'summary'=>"Sofia",'pictures_list'=>"Sofia",'questionnaire'=>"Population"},{'category_sign'=>"population",'name_ua'=>"Визначні місця",'name_ru'=>"Достопримечательности",'file'=>"Sights0",'summary'=>"Sights",'pictures_list'=>"Sights",'questionnaire'=>"Population"},{'category_sign'=>"population",'name_ua'=>"Визначні місця центру міста",'name_ru'=>"Достопримечательности центра города",'file'=>"Sights1",'summary'=>"Sights",'pictures_list'=>"Sights",'questionnaire'=>"Population"},{'category_sign'=>"population",'name_ua'=>"Музей народної архітектури та побуту України",'name_ru'=>"Музей народной архитектуры и быта Украины",'file'=>"FolkArchMuseum",'summary'=>"FolkArchMuseum",'pictures_list'=>"FolkArchMuseum",'questionnaire'=>"Population"},{'category_sign'=>"population",'name_ua'=>"Києво-Печерська лавра. Заповідник і монастир",'name_ru'=>"Киево-Печерская лавра. Заповедник и монастырь",'file'=>"Lavra",'summary'=>"Lavra",'pictures_list'=>"Lavra",'questionnaire'=>"Population"},{'category_sign'=>"population",'name_ua'=>"Видатні особи в Києві",'name_ru'=>"Выдающиеся личности в Киеве",'file'=>"Famous",'summary'=>"Famous",'pictures_list'=>"Famous",'questionnaire'=>"Population"},{'category_sign'=>"economics",'name_ua'=>"Промисловість",'name_ru'=>"Промышленность",'file'=>"Industry",'summary'=>"Industry",'pictures_list'=>"Industry",'questionnaire'=>"Industry"},{'category_sign'=>"economics",'name_ua'=>"Електроенергетика",'name_ru'=>"Электроэнергетика",'file'=>"PowerIndustry",'summary'=>"PowerIndustry",'pictures_list'=>"Industry",'questionnaire'=>"Industry"},{'category_sign'=>"economics",'name_ua'=>"Забруднення повітря",'name_ru'=>"Загрязнение воздуха",'file'=>"Pollution",'summary'=>"Pollution",'pictures_list'=>"Industry",'questionnaire'=>"Industry"},{'category_sign'=>"economics",'name_ua'=>"Транспорт і зв'язок",'name_ru'=>"Транспорт и связь",'file'=>"Transport",'summary'=>"Transport",'pictures_list'=>"Industry",'questionnaire'=>"Industry"},{'category_sign'=>"economics",'name_ua'=>"Транспорт у 1914 році",'name_ru'=>"Транспорт в 1914 году",'file'=>"Transport1914",'summary'=>"Transport1914",'pictures_list'=>"Transport1914",'questionnaire'=>"Transport1914"},{'category_sign'=>"economics",'name_ua'=>"Метрополітен",'name_ru'=>"Метрополитен",'file'=>"Metro",'summary'=>"Metro",'pictures_list'=>"Industry",'questionnaire'=>"Industry"},{'category_sign'=>"past",'name_ua'=>"Найдавніші поселення на території міста",'name_ru'=>"Древнейшие поселения на территории города",'file'=>"Ancient",'summary'=>"Ancient",'pictures_list'=>"KievHist",'questionnaire'=>"KievHist"},{'category_sign'=>"past",'name_ua'=>"945 рік",'name_ru'=>"945 год",'file'=>"Kiev945",'summary'=>"Kiev945",'pictures_list'=>"KievHist",'questionnaire'=>"KievHist"},{'category_sign'=>"past",'name_ua'=>"1240 рік",'name_ru'=>"1240",'file'=>"Kiev1240",'summary'=>"Kiev1240",'pictures_list'=>"KievHist",'questionnaire'=>"KievHist"},{'category_sign'=>"past",'name_ua'=>"1648 рік",'name_ru'=>"1648",'file'=>"Kiev1648",'summary'=>"Kiev1648",'pictures_list'=>"KievHist",'questionnaire'=>"KievHist"},{'category_sign'=>"past",'name_ua'=>"1786 рік",'name_ru'=>"1786",'file'=>"Kiev1786",'summary'=>"Kiev1786",'pictures_list'=>"KievHist",'questionnaire'=>"KievHist"},{'category_sign'=>"past",'name_ua'=>"1914 рік",'name_ru'=>"1914",'file'=>"Kiev19140",'summary'=>"Kiev1914",'pictures_list'=>"KievHist",'questionnaire'=>"KievHist"},{'category_sign'=>"past",'name_ua'=>"1914 рік. Центр міста",'name_ru'=>"1914. Центр города",'file'=>"Kiev19141",'summary'=>"Kiev1914",'pictures_list'=>"KievHist",'questionnaire'=>"KievHist"}].each{|map| Map.create(map) }
    end
    if Bill.find(:all).size == 0
      code = (0...6).map{(65 + rand(26)).chr }.join
      token =  (0...32).map.with_index{|i| ('a'..'z').to_a.concat(('0'..'9').to_a)[rand(36)] }.join
      Bill.create({'code' => code, 'token' => token, 'paid' => 0})
    end
    if Control.find(:all).size == 0
      # PLACEHOLDER: default_lang, e.g. default_lang = 'ru'
      default_lang = 'ua'
      Control.create({'name' => 'lang', 'value' => default_lang, 'type' => 'select', 'values_str' => '["ru","ua"]'})
      Control.create({'name' => 'icon_size', 'value' => (System::get_property('platform') == 'APPLE' ? 'small' : 'normal'), 'type' => 'select', 'values_str' => '["small","normal"]'})
      Control.create({'name' => 'zoom_step', 'value' => '70', 'type' => 'range', 'values_str' => '{"min":50,"max":100,"step":1}'})
      Control.create({'name' => 'show_controls_icon', 'value' => '1', 'type' => 'checkbox'})
    end

    # Tab items are loaded left->right, @tabs[0] is leftmost tab in the tab-bar
    # Super must be called *after* settings @tabs!
    @tabs = nil
    #To remove default toolbar uncomment next line:
    @@toolbar = nil
    super

    # Uncomment to set sync notification callback to /app/Settings/sync_notify.
    # SyncEngine::set_objectnotify_url("/app/Settings/sync_notify")
    SyncEngine.set_notification(-1, "/app/Settings/sync_notify", '')
  end
end
